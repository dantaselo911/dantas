(function() {
    const gabarito = [
      { "questao_numero": 1, "alternativa_correta": "[IMAGEM] https://edusp-static.ip.tv/tms/edusp/tv.ip.edusp/AaiDkRlOyyjITYDe1ETaY9e6LrN130.jpg" },
      { "questao_numero": 2, "alternativa_correta": "1,09" },
      { "questao_numero": 3, "alternativa_correta": "igual a 8." },
      { "questao_numero": 4, "alternativa_correta": "resolu√ß√£o IV." },
      { "questao_numero": 5, "alternativa_correta": "[IMAGEM] https://edusp-static.ip.tv/tms/edusp/tv.ip.edusp/BbtopN2SvNHSSoKIV5KVuoYjDMYAqA.jpg" },
      { "questao_numero": 6, "alternativa_correta": "R$ 381,00" },
      { "questao_numero": 7, "alternativa_correta": "10" },
      { "questao_numero": 8, "alternativa_correta": "[IMAGEM] data:image/jpeg;base64,/9j/4AAQSk..." },
      { "questao_numero": 9, "alternativa_correta": "1,21" },
      { "questao_numero": 10, "alternativa_correta": "[IMAGEM] https://edusp-static.ip.tv/tms/edusp/tv.ip.edusp/OVxvxi5cmA5JcqLmGCiDXLRf6Ss9hW.jpg" },
      { "questao_numero": 11, "alternativa_correta": "10" },
      { "questao_numero": 12, "alternativa_correta": "[IMAGEM] https://edusp-static.ip.tv/tms/edusp/tv.ip.edusp/1EMDxRK2CPNi8Ho5Wk47TcVd4LGsvf.jpg" },
      { "questao_numero": 13, "alternativa_correta": "[IMAGEM] data:image/jpeg;base64,/9j/4AAQSk..." },
      { "questao_numero": 14, "alternativa_correta": "30" },
      { "questao_numero": 15, "alternativa_correta": "5 20" },
      { "questao_numero": 16, "alternativa_correta": "R$ 2.560,00" },
      { "questao_numero": 17, "alternativa_correta": "Saber quanto se ganha e quanto se pode gastar, evitando desequil√≠brios." },
      { "questao_numero": 18, "alternativa_correta": "Planejamento financeiro inadequado." },
      { "questao_numero": 19, "alternativa_correta": "Negociar as d√≠vidas e ajustar o or√ßamento familiar." },
      { "questao_numero": 20, "alternativa_correta": "Refletir se realmente precisa de algo a mais antes de decidir pela compra." },
      { "questao_numero": 21, "alternativa_correta": "Registro di√°rio e organizado de todos os gastos, inclusive os pequenos." },
      { "questao_numero": 22, "alternativa_correta": "Evitar d√≠vidas e fazer escolhas que respeitem a pr√≥pria realidade financeira." },
      { "questao_numero": 23, "alternativa_correta": "RNA." },
      { "questao_numero": 24, "alternativa_correta": "realizado no n√∫cleo, √© produzida uma fita de RNA a partir do DNA." },
      { "questao_numero": 25, "alternativa_correta": "Tradu√ß√£o, que ocorre nos ribossomos e monta cadeias de amino√°cidos." },
      { "questao_numero": 26, "alternativa_correta": "3 verdes : 1 amarela" },
      { "questao_numero": 27, "alternativa_correta": "Clone √© um ser ou c√©lula com o mesmo material gen√©tico do original, √∫til na produ√ß√£o de tecidos e no estudo de doen√ßas." },
      { "questao_numero": 28, "alternativa_correta": "Esse tipo de tratamento atua substituindo, inativando ou reparando genes que causam doen√ßas gen√©ticas. √â importante que a decis√£o da fam√≠lia seja baseada em informa√ß√µes acess√≠veis e compreens√≠veis." },
      { "questao_numero": 29, "alternativa_correta": "Fonte prim√°ria, fonte prim√°ria, fonte secund√°ria." },
      { "questao_numero": 30, "alternativa_correta": "900" },
      { "questao_numero": 31, "alternativa_correta": "Refra√ß√£o da luz." },
      { "questao_numero": 32, "alternativa_correta": "Refrator." },
      { "questao_numero": 33, "alternativa_correta": "60¬∞" },
      { "questao_numero": 34, "alternativa_correta": "espelho esf√©rico convexo." },
      { "questao_numero": 35, "alternativa_correta": "o √¢nodo perde el√©trons e o c√°todo ganha el√©trons." },
      { "questao_numero": 36, "alternativa_correta": "+1" },
      { "questao_numero": 37, "alternativa_correta": "ŒîE¬∞ = +3,17 V" },
      { "questao_numero": 38, "alternativa_correta": "Ni-Cd, por apresentar o maior n√∫mero de ciclos." },
      { "questao_numero": 39, "alternativa_correta": "negativo, chamado c√°todo." },
      { "questao_numero": 40, "alternativa_correta": "Galvanoplastia: uso de corrente el√©trica para depositar uma camada de cromo sobre outro metal." },
      { "questao_numero": 41, "alternativa_correta": "Garantir contraste adequado entre texto e fundo." },
      { "questao_numero": 42, "alternativa_correta": "Um procedimento que ajuda a prevenir a viola√ß√£o de direitos autorais por registrar a origem e a licen√ßa da imagem." },
      { "questao_numero": 43, "alternativa_correta": "Reescrever o conte√∫do do texto com suas pr√≥prias palavras e indicar a fonte da informa√ß√£o." },
      { "questao_numero": 44, "alternativa_correta": "Criar bot√µes de ajuste de tamanho de fonte." },
      { "questao_numero": 45, "alternativa_correta": "botaoDeAcessibilidade.addEventListener('click', function() { opcoesDeAcessibilidade.classList.toggle('apresenta-lista'); });" }
    ];

    function normalizar(txt) {
        return txt.toLowerCase()
                  .normalize("NFD")
                  .replace(/[\u0300-\u036f]/g, "")
                  .replace(/\s+/g, " ")
                  .trim();
    }

    // Painel flutuante
    const overlay = document.createElement('div');
    overlay.innerHTML = `
      <div style="position: fixed; top:20px; right:20px; background:#2c3e50; color:white; padding:15px; border-radius:10px; width:300px; font-family:Arial; z-index:99999;">
        <h3 style="margin:0 0 10px 0; font-size:16px; display:flex; justify-content:space-between; align-items:center;">
          ü§ñ AutoResponder
          <button id="fecharBtn" style="background:#e74c3c; border:none; color:white; width:24px; height:24px; border-radius:50%; cursor:pointer;">‚úï</button>
        </h3>
        <div id="status" style="margin:10px 0; font-size:14px;">Aguardando...</div>
        <button id="iniciarBtn" style="background:#27ae60; border:none; color:white; padding:8px; border-radius:5px; font-weight:bold; width:100%;">‚ñ∂Ô∏è Iniciar Automa√ß√£o</button>
        <button id="pararBtn" style="background:#e67e22; border:none; color:white; padding:8px; border-radius:5px; font-weight:bold; width:100%; margin-top:8px; display:none;">‚èπÔ∏è Parar</button>
      </div>
    `;
    document.body.appendChild(overlay);

    const statusDiv = overlay.querySelector('#status');
    const iniciarBtn = overlay.querySelector('#iniciarBtn');
    const pararBtn = overlay.querySelector('#pararBtn');
    const fecharBtn = overlay.querySelector('#fecharBtn');

    fecharBtn.addEventListener('click', () => overlay.remove());

    let observando = false, ultimoNumeroQuestao = null;

    function atualizarStatus(txt, cor="#ecf0f1") {
      statusDiv.innerHTML = txt;
      statusDiv.style.color = cor;
    }

    function clicarProximo() {
      const btn = [...document.querySelectorAll("button,a")].find(b =>
        /pr[o√≥]xima?|avan[c√ß]ar|continuar|seguinte|prosseguir|salvar/i.test(b.textContent.trim())
      );
      if (btn) {
        btn.scrollIntoView({behavior:"smooth", block:"center"});
        setTimeout(()=>btn.click(),300);
      }
    }

    function responderPeloTexto() {
      const numEl = [...document.querySelectorAll("*")].find(el => /quest√£o\s*(\d+)/i.test(el.textContent));
      if (!numEl) return;
      const numero = parseInt(numEl.textContent.match(/quest√£o\s*(\d+)/i)[1]);
      if (numero === ultimoNumeroQuestao) return;
      ultimoNumeroQuestao = numero;

      const questao = gabarito.find(q=>q.questao_numero===numero);
      if (!questao) return atualizarStatus(`‚ö†Ô∏è Q${numero} n√£o no gabarito`,"#e67e22");

      const correta = normalizar(questao.alternativa_correta);
      const candidatos = [...document.querySelectorAll("*")].filter(el=> el.textContent && normalizar(el.textContent).includes(correta));

      if (candidatos.length) {
        let alvo = candidatos[0];
        while (alvo && alvo.tagName!=="LABEL") alvo=alvo.parentElement;
        if(!alvo) alvo=candidatos[0];
        alvo.scrollIntoView({behavior:"smooth", block:"center"});
        setTimeout(()=>{
          const input = alvo.querySelector('input[type="radio"],input[type="checkbox"]');
          if(input && !input.disabled) input.click(); else alvo.click();
          atualizarStatus(`‚úÖ Quest√£o ${numero} respondida!`,"#27ae60");
          setTimeout(clicarProximo,1000);
        },800);
      } else {
        atualizarStatus(`‚ö†Ô∏è Alternativa n√£o encontrada Q${numero}`,"#e67e22");
        setTimeout(clicarProximo,1000);
      }
    }

    function iniciar() {
      if(observando) return;
      observando=true; iniciarBtn.style.display="none"; pararBtn.style.display="block";
      responderPeloTexto();
      const observer = new MutationObserver(()=>{ if(observando) responderPeloTexto(); });
      observer.observe(document.body,{childList:true,subtree:true,attributes:true,characterData:true});
      overlay.observer=observer;
      overlay.intervalo=setInterval(()=>{ if(observando) responderPeloTexto(); },2000);
    }

    function parar() {
      observando=false; iniciarBtn.style.display="block"; pararBtn.style.display="none";
      if(overlay.observer) overlay.observer.disconnect();
      if(overlay.intervalo) clearInterval(overlay.intervalo);
      atualizarStatus("‚èπÔ∏è Automa√ß√£o parada.");
    }

    iniciarBtn.addEventListener('click', iniciar);
    pararBtn.addEventListener('click', parar);

    atualizarStatus("‚úÖ Sistema carregado. Clique em 'Iniciar'.","#27ae60");
})();

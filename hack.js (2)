(function() {
    const gabarito = [
        {
            "questao_numero": 1,
            "id_da_questao": 392847501,
            "alternativa_correta": "I - reta normal; II - raio incidente; III - raio refletido."
        },
        {
            "questao_numero": 2,
            "id_da_questao": 282754095,
            "alternativa_correta": "O sistema opressor escravocrata."
        }
        [
  { "questao_numero": 1, "alternativa_correta": "[IMAGEM] https://edusp-static.ip.tv/tms/edusp/tv.ip.edusp/AaiDkRlOyyjITYDe1ETaY9e6LrN130.jpg" },
  { "questao_numero": 2, "alternativa_correta": "1,09" },
  { "questao_numero": 3, "alternativa_correta": "igual a 8." },
  { "questao_numero": 4, "alternativa_correta": "resolu√ß√£o IV." },
  { "questao_numero": 5, "alternativa_correta": "[IMAGEM] https://edusp-static.ip.tv/tms/edusp/tv.ip.edusp/BbtopN2SvNHSSoKIV5KVuoYjDMYAqA.jpg" },
  { "questao_numero": 6, "alternativa_correta": "R$ 381,00" },
  { "questao_numero": 7, "alternativa_correta": "10" },
  { "questao_numero": 8, "alternativa_correta": "[IMAGEM] data:image/jpeg;base64,/9j/4AAQSk..." },
  { "questao_numero": 9, "alternativa_correta": "1,21" },
  { "questao_numero": 10, "alternativa_correta": "[IMAGEM] https://edusp-static.ip.tv/tms/edusp/tv.ip.edusp/OVxvxi5cmA5JcqLmGCiDXLRf6Ss9hW.jpg" },
  { "questao_numero": 11, "alternativa_correta": "10" },
  { "questao_numero": 12, "alternativa_correta": "[IMAGEM] https://edusp-static.ip.tv/tms/edusp/tv.ip.edusp/1EMDxRK2CPNi8Ho5Wk47TcVd4LGsvf.jpg" },
  { "questao_numero": 13, "alternativa_correta": "[IMAGEM] data:image/jpeg;base64,/9j/4AAQSk..." },
  { "questao_numero": 14, "alternativa_correta": "30" },
  { "questao_numero": 15, "alternativa_correta": "5 20" },
  { "questao_numero": 16, "alternativa_correta": "R$ 2.560,00" },
  { "questao_numero": 17, "alternativa_correta": "Saber quanto se ganha e quanto se pode gastar, evitando desequil√≠brios." },
  { "questao_numero": 18, "alternativa_correta": "Planejamento financeiro inadequado." },
  { "questao_numero": 19, "alternativa_correta": "Negociar as d√≠vidas e ajustar o or√ßamento familiar." },
  { "questao_numero": 20, "alternativa_correta": "Refletir se realmente precisa de algo a mais antes de decidir pela compra." },
  { "questao_numero": 21, "alternativa_correta": "Registro di√°rio e organizado de todos os gastos, inclusive os pequenos." },
  { "questao_numero": 22, "alternativa_correta": "Evitar d√≠vidas e fazer escolhas que respeitem a pr√≥pria realidade financeira." },
  { "questao_numero": 23, "alternativa_correta": "RNA." },
  { "questao_numero": 24, "alternativa_correta": "realizado no n√∫cleo, √© produzida uma fita de RNA a partir do DNA." },
  { "questao_numero": 25, "alternativa_correta": "Tradu√ß√£o, que ocorre nos ribossomos e monta cadeias de amino√°cidos." },
  { "questao_numero": 26, "alternativa_correta": "3 verdes : 1 amarela" },
  { "questao_numero": 27, "alternativa_correta": "Clone √© um ser ou c√©lula com o mesmo material gen√©tico do original, √∫til na produ√ß√£o de tecidos e no estudo de doen√ßas." },
  { "questao_numero": 28, "alternativa_correta": "Esse tipo de tratamento atua substituindo, inativando ou reparando genes que causam doen√ßas gen√©ticas. √â importante que a decis√£o da fam√≠lia seja baseada em informa√ß√µes acess√≠veis e compreens√≠veis." },
  { "questao_numero": 29, "alternativa_correta": "Fonte prim√°ria, fonte prim√°ria, fonte secund√°ria." },
  { "questao_numero": 30, "alternativa_correta": "900" },
  { "questao_numero": 31, "alternativa_correta": "Refra√ß√£o da luz." },
  { "questao_numero": 32, "alternativa_correta": "Refrator." },
  { "questao_numero": 33, "alternativa_correta": "60¬∞" },
  { "questao_numero": 34, "alternativa_correta": "espelho esf√©rico convexo." },
  { "questao_numero": 35, "alternativa_correta": "o √¢nodo perde el√©trons e o c√°todo ganha el√©trons." },
  { "questao_numero": 36, "alternativa_correta": "+1" },
  { "questao_numero": 37, "alternativa_correta": "ŒîE¬∞ = +3,17 V" },
  { "questao_numero": 38, "alternativa_correta": "Ni-Cd, por apresentar o maior n√∫mero de ciclos." },
  { "questao_numero": 39, "alternativa_correta": "negativo, chamado c√°todo." },
  { "questao_numero": 40, "alternativa_correta": "Galvanoplastia: uso de corrente el√©trica para depositar uma camada de cromo sobre outro metal." },
  { "questao_numero": 41, "alternativa_correta": "Garantir contraste adequado entre texto e fundo." },
  { "questao_numero": 42, "alternativa_correta": "Um procedimento que ajuda a prevenir a viola√ß√£o de direitos autorais por registrar a origem e a licen√ßa da imagem." },
  { "questao_numero": 43, "alternativa_correta": "Reescrever o conte√∫do do texto com suas pr√≥prias palavras e indicar a fonte da informa√ß√£o." },
  { "questao_numero": 44, "alternativa_correta": "Criar bot√µes de ajuste de tamanho de fonte." },
  { "questao_numero": 45, "alternativa_correta": "botaoDeAcessibilidade.addEventListener('click', function() { opcoesDeAcessibilidade.classList.toggle('apresenta-lista'); });" }
]
    ];

    // Fun√ß√£o p/ normalizar textos (ignora acento, mai√∫scula, espa√ßos extras)
    function normalizar(txt) {
        return txt.toLowerCase()
                  .normalize("NFD")
                  .replace(/[\u0300-\u036f]/g, "")
                  .replace(/\s+/g, " ")
                  .trim();
    }

    // Painel flutuante
    const overlay = document.createElement('div');
    overlay.innerHTML = `
        <div style="
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 99999;
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            font-family: Arial, sans-serif;
            width: 300px;
        ">
            <h3 style="margin: 0 0 10px 0; font-size: 16px; display: flex; justify-content: space-between; align-items: center;">
                ü§ñ AutoResponder
                <button id="fecharBtn" style="
                    background: #e74c3c;
                    border: none;
                    color: white;
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    cursor: pointer;
                ">‚úï</button>
            </h3>
            <div id="status" style="margin: 10px 0; font-size: 14px; color: #ecf0f1;">Aguardando...</div>
            <button id="iniciarBtn" style="
                background: #27ae60;
                border: none;
                color: white;
                padding: 8px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-weight: bold;
                width: 100%;
            ">‚ñ∂Ô∏è Iniciar Automa√ß√£o</button>
            <button id="pararBtn" style="
                background: #e67e22;
                border: none;
                color: white;
                padding: 8px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-weight: bold;
                width: 100%;
                margin-top: 8px;
                display: none;
            ">‚èπÔ∏è Parar</button>
        </div>
    `;
    document.body.appendChild(overlay);

    const fecharBtn = overlay.querySelector('#fecharBtn');
    const iniciarBtn = overlay.querySelector('#iniciarBtn');
    const pararBtn = overlay.querySelector('#pararBtn');
    const statusDiv = overlay.querySelector('#status');

    fecharBtn.addEventListener('click', () => overlay.remove());

    let observando = false;
    let ultimoNumeroQuestao = null;

    function atualizarStatus(texto, cor = '#ecf0f1') {
        statusDiv.innerHTML = texto;
        statusDiv.style.color = cor;
    }

    function clicarProximo() {
        const btnProximo = [...document.querySelectorAll('button, a')]
            .find(btn => 
                /pr[o√≥]xima?|avan[c√ß]ar|continuar|seguinte|prosseguir|salvar/i.test(btn.textContent.trim())
            );
        if (btnProximo) {
            btnProximo.scrollIntoView({ behavior: 'smooth', block: 'center' });
            setTimeout(() => btnProximo.click(), 300);
        }
    }

    function responderPeloTexto() {
        const elementoNumero = [...document.querySelectorAll('*')].find(el => 
            /quest√£o\s*(\d+)/i.test(el.textContent)
        );
        if (!elementoNumero) return;

        const numeroQuestao = parseInt(elementoNumero.textContent.match(/quest√£o\s*(\d+)/i)[1]);
        if (numeroQuestao === ultimoNumeroQuestao) return;
        ultimoNumeroQuestao = numeroQuestao;

        atualizarStatus(`üìå Detectada quest√£o ${numeroQuestao}...`, "#f39c12");

        const questao = gabarito.find(q => q.questao_numero === numeroQuestao);
        if (!questao) {
            atualizarStatus(`‚ö†Ô∏è Quest√£o ${numeroQuestao} n√£o no gabarito ‚Äî pulando...`, "#e67e22");
            setTimeout(clicarProximo, 1000);
            return;
        }

        const textoCorreto = normalizar(questao.alternativa_correta);

        const candidatos = [...document.querySelectorAll('*')].filter(el => {
            if (!el.textContent) return false;
            return normalizar(el.textContent).includes(textoCorreto);
        });

        if (candidatos.length > 0) {
            let alvo = candidatos[0];
            while (alvo && alvo.tagName !== 'LABEL') alvo = alvo.parentElement;
            if (!alvo) alvo = candidatos[0];

            alvo.scrollIntoView({ behavior: 'smooth', block: 'center' });
            setTimeout(() => {
                const input = alvo.querySelector('input[type="radio"], input[type="checkbox"]');
                if (input && !input.disabled) input.click();
                else alvo.click();
                atualizarStatus(`‚úÖ Respondido: Quest√£o ${numeroQuestao}!`, "#27ae60");
                setTimeout(clicarProximo, 1000);
            }, 800);
        } else {
            atualizarStatus(`‚ö†Ô∏è Alternativa n√£o encontrada na tela.`, "#e67e22");
            setTimeout(clicarProximo, 1000);
        }
    }

    function iniciarObservador() {
        if (observando) return;
        observando = true;
        iniciarBtn.style.display = 'none';
        pararBtn.style.display = 'block';
        responderPeloTexto();

        const observer = new MutationObserver(() => {
            if (observando) responderPeloTexto();
        });
        observer.observe(document.body, { childList: true, subtree: true, attributes: true, characterData: true });

        const intervalo = setInterval(() => {
            if (observando) responderPeloTexto();
        }, 2000);

        overlay.observer = observer;
        overlay.intervalo = intervalo;
    }

    function pararObservador() {
        observando = false;
        iniciarBtn.style.display = 'block';
        pararBtn.style.display = 'none';
        if (overlay.observer) overlay.observer.disconnect();
        if (overlay.intervalo) clearInterval(overlay.intervalo);
        atualizarStatus("‚èπÔ∏è Automa√ß√£o parada.", "#ecf0f1");
    }

    iniciarBtn.addEventListener('click', iniciarObservador);
    pararBtn.addEventListener('click', pararObservador);

    atualizarStatus("‚úÖ Sistema carregado. Clique em 'Iniciar'.", "#27ae60");
})();            width: 300px;
            cursor: move;
            user-select: none;
        ">
            <h3 style="margin: 0 0 10px 0; font-size: 16px; display: flex; justify-content: space-between; align-items: center;">
                ü§ñ AutoResponder
                <button id="fecharBtn" style="
                    background: #e74c3c;
                    border: none;
                    color: white;
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    cursor: pointer;
                    font-size: 12px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                ">‚úï</button>
            </h3>
            <div id="status" style="margin: 10px 0; font-size: 14px; color: #ecf0f1;">Aguardando...</div>
            <button id="iniciarBtn" style="
                background: #27ae60;
                border: none;
                color: white;
                padding: 8px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-weight: bold;
                width: 100%;
            ">‚ñ∂Ô∏è Iniciar Automa√ß√£o</button>
            <button id="pararBtn" style="
                background: #e67e22;
                border: none;
                color: white;
                padding: 8px 15px;
                border-radius: 5px;
                cursor: pointer;
                font-weight: bold;
                width: 100%;
                margin-top: 8px;
                display: none;
            ">‚èπÔ∏è Parar</button>
        </div>
    `;

    document.body.appendChild(overlay);

    // Torna a janela arrast√°vel
    let isDragging = false;
    let offsetX, offsetY;
    const header = overlay.querySelector('h3');

    header.addEventListener('mousedown', (e) => {
        if (e.target.id === 'fecharBtn') return;
        isDragging = true;
        offsetX = e.clientX - overlay.getBoundingClientRect().left;
        offsetY = e.clientY - overlay.getBoundingClientRect().top;
    });

    document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        overlay.style.left = (e.clientX - offsetX) + 'px';
        overlay.style.top = (e.clientY - offsetY) + 'px';
        overlay.style.right = 'auto';
        overlay.style.bottom = 'auto';
    });

    document.addEventListener('mouseup', () => isDragging = false);

    // Bot√µes
    const fecharBtn = overlay.querySelector('#fecharBtn');
    const iniciarBtn = overlay.querySelector('#iniciarBtn');
    const pararBtn = overlay.querySelector('#pararBtn');
    const statusDiv = overlay.querySelector('#status');

    fecharBtn.addEventListener('click', () => overlay.remove());

    let observando = false;
    let ultimoNumeroQuestao = null;

    function atualizarStatus(texto, cor = '#ecf0f1') {
        statusDiv.innerHTML = texto;
        statusDiv.style.color = cor;
    }

    function clicarProximo() {
        const btnProximo = [...document.querySelectorAll('button, a')]
            .find(btn => 
                /pr[o√≥]xima?|avan[c√ß]ar|continuar|seguinte|prosseguir|salvar/i.test(btn.textContent.trim())
            );

        if (btnProximo) {
            btnProximo.scrollIntoView({ behavior: 'smooth', block: 'center' });
            setTimeout(() => {
                btnProximo.click();
                atualizarStatus("‚è≠Ô∏è Avan√ßando para pr√≥xima quest√£o...", "#3498db");
            }, 300);
        } else {
            atualizarStatus("‚ö†Ô∏è Bot√£o 'Pr√≥ximo' n√£o encontrado.", "#e67e22");
        }
    }

    function responderPeloTexto() {
        // 1. Procura n√∫mero da quest√£o
        const elementoNumero = [...document.querySelectorAll('*')].find(el => 
            /quest√£o\s*(\d+)/i.test(el.textContent)
        );

        if (!elementoNumero) {
            atualizarStatus("‚ùå N√£o encontrei n√∫mero da quest√£o.", "#e74c3c");
            return;
        }

        const numeroQuestao = parseInt(elementoNumero.textContent.match(/quest√£o\s*(\d+)/i)[1]);

        // S√≥ executa se mudou de quest√£o
        if (numeroQuestao === ultimoNumeroQuestao) return;
        ultimoNumeroQuestao = numeroQuestao;

        atualizarStatus(`üìå Detectada quest√£o ${numeroQuestao}...`, "#f39c12");

        // 2. Busca no gabarito
        const questao = gabarito.find(q => q.questao_numero === numeroQuestao);
        if (!questao) {
            atualizarStatus(`‚ö†Ô∏è Quest√£o ${numeroQuestao} n√£o no gabarito ‚Äî pulando...`, "#e67e22");
            setTimeout(clicarProximo, 1000);
            return;
        }

        // 3. Pega texto correto
        const textoCorreto = Object.values(questao.alternativa_correta)[0].trim();

        // 4. Procura em qualquer elemento
        const candidatos = [...document.querySelectorAll('*')].filter(el => {
            if (!el.textContent) return false;
            const texto = el.textContent.trim();
            const semLetra = texto.replace(/^\s*[A-Z][\)\.]\s*/i, '').trim();
            return semLetra.replace(/\s+/g, ' ') === textoCorreto.replace(/\s+/g, ' ');
        });

        if (candidatos.length === 0) {
            atualizarStatus(`‚ö†Ô∏è Alternativa n√£o encontrada ‚Äî pulando quest√£o ${numeroQuestao}...`, "#e67e22");
            setTimeout(clicarProximo, 1000); // ‚¨ÖÔ∏è AQUI: pula se n√£o achar!
            return;
        }

        // 5. Encontra label pai
        let alvo = candidatos[0];
        while (alvo && alvo.tagName !== 'LABEL') {
            alvo = alvo.parentElement;
        }
        if (!alvo) alvo = candidatos[0];

        // 6. Rola e clica
        alvo.scrollIntoView({ behavior: 'smooth', block: 'center' });

        setTimeout(() => {
            const input = alvo.querySelector('input[type="radio"], input[type="checkbox"]');
            if (input && !input.disabled) {
                input.click();
                atualizarStatus(`‚úÖ Respondido: Quest√£o ${numeroQuestao}!`, "#27ae60");
            } else {
                alvo.click();
                atualizarStatus(`‚úÖ Respondido (click direto): Quest√£o ${numeroQuestao}!`, "#27ae60");
            }

            // ‚è≠Ô∏è CLICA EM "PR√ìXIMO" AP√ìS 1 SEGUNDO
            setTimeout(clicarProximo, 1000);

        }, 800);
    }

    function iniciarObservador() {
        if (observando) return;
        observando = true;
        iniciarBtn.style.display = 'none';
        pararBtn.style.display = 'block';

        // Executa imediatamente
        responderPeloTexto();

        // Observa mudan√ßas na p√°gina (muta√ß√µes)
        const observer = new MutationObserver(() => {
            if (observando) responderPeloTexto();
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            characterData: true
        });

        // Tamb√©m verifica a cada 2 segundos (backup)
        const intervalo = setInterval(() => {
            if (observando) responderPeloTexto();
        }, 2000);

        // Salva para parar depois
        overlay.observer = observer;
        overlay.intervalo = intervalo;
    }

    function pararObservador() {
        observando = false;
        iniciarBtn.style.display = 'block';
        pararBtn.style.display = 'none';
        if (overlay.observer) overlay.observer.disconnect();
        if (overlay.intervalo) clearInterval(overlay.intervalo);
        atualizarStatus("‚èπÔ∏è Automa√ß√£o parada.", "#ecf0f1");
    }

    iniciarBtn.addEventListener('click', iniciarObservador);
    pararBtn.addEventListener('click', pararObservador);

    // Estilo inicial
    overlay.style.position = 'fixed';
    overlay.style.top = '20px';
    overlay.style.right = '20px';
    overlay.style.zIndex = '99999';

    atualizarStatus("‚úÖ Sistema carregado. Clique em 'Iniciar'.", "#27ae60");
})();
